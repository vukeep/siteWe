import { z } from 'zod'

/**
 * Схема валидации формы заявки
 * 
 * Используется для валидации:
 * - Контактной формы на главной странице
 * - Формы "Хочу также" в галерее
 * - Формы "Получить расчет" в секции тарифов
 * 
 * Все поля обязательны, применяются строгие правила валидации
 * для обеспечения качества входящих лидов
 */
export const leadFormSchema = z.object({
  // Имя клиента (минимум 2 символа)
  name: z
    .string()
    .min(2, 'Имя должно содержать минимум 2 символа')
    .max(100, 'Имя не должно превышать 100 символов')
    .regex(/^[а-яА-ЯёЁa-zA-Z\s-]+$/, 'Имя может содержать только буквы, пробелы и дефисы'),

  // Название компании
  company: z
    .string()
    .min(2, 'Укажите название компании')
    .max(200, 'Название компании не должно превышать 200 символов'),

  // Телефон (поддержка различных форматов)
  phone: z
    .string()
    .min(10, 'Телефон должен содержать минимум 10 цифр')
    .regex(
      /^[\d\s\+\-\(\)]+$/,
      'Некорректный формат телефона. Используйте только цифры, пробелы, +, -, ( )'
    ),

  // Email (стандартная валидация)
  email: z
    .string()
    .email('Некорректный email адрес')
    .toLowerCase(),

  // Задача/описание проекта
  task: z
    .string()
    .min(10, 'Опишите задачу подробнее (минимум 10 символов)')
    .max(1000, 'Описание не должно превышать 1000 символов'),

  // Тип заявки (для аналитики)
  requestType: z
    .enum(['general', 'portfolio_request', 'pricing_calculation'])
    .default('general'),

  // Количество роликов (только для формы расчета)
  videoCount: z
    .enum(['1-5', '6-10', '11-20', '21-50', '50+'])
    .optional(),

  // Honeypot поле для защиты от ботов (должно быть пустым)
  _hp: z.string().max(0).optional(),
})

/**
 * TypeScript тип для формы заявки
 */
export type LeadFormData = z.infer<typeof leadFormSchema>

/**
 * Схема для ответа API
 */
export const leadResponseSchema = z.object({
  success: z.boolean(),
  message: z.string(),
  leadId: z.string().optional(),
})

export type LeadResponse = z.infer<typeof leadResponseSchema>

